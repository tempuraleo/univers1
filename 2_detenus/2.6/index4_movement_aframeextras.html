
<html>

<head>
    <title>Animations - 09 - Events - Proximity</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-proxemic-component@0.0.17/dist/aframe-proxemic-component.min.js"></script>
    <script>
        AFRAME.registerComponent('model-opacity', {
            schema: {
                default: 1.0
            },
            init: function () {
                this.el.addEventListener('model-loaded', this.update.bind(this));
            },
            update: function () {
                var mesh = this.el.getObject3D('mesh');
                var data = this.data;
                if (!mesh) {
                    return;
                }
                mesh.traverse(function (node) {
                    if (node.isMesh) {
                        node.material.opacity = data;
                        node.material.transparent = data < 1.0;
                        node.material.needsUpdate = true;
                    }
                });
            }
        });
    </script>
</head>

<body>
    <a-scene background="color:lightblue" >
        <a-assets>
            <a-asset-item id="antoine4" src="models/antoine4.glb"></a-asset-item>
            <a-asset-item id="antoine5" src="models/antoine5.glb"></a-asset-item>
            <a-asset-item id="loicnrv" src="models/loicnrv.glb"></a-asset-item>
            <a-asset-item id="loic" src="models/loic.glb"></a-asset-item>
            <a-asset-item id="martinnrv" src="models/martinnrv.glb"></a-asset-item>
            <a-asset-item id="martin" src="models/martin.glb"></a-asset-item>
            <a-asset-item id="maison" src="models/cellule1.glb"></a-asset-item>

        </a-assets>

        <a-entity gltf-model="#maison" position="0 0 0" rotation="0 90 0"  scale="0.3 0.35 0.3" animation-mixer></a-entity>


        <a-entity id="model3D2" gltf-model="#antoine4" position="0.035 0.835 1.428" scale="1 1 1" rotation="0 -171.483 0" proximity-sensor="distance:1" model-opacity="0.001"
            animation__open="property: model-opacity; to: 1; startEvents: proximityenter"
            animation__close="property: model-opacity; to: 0.01; startEvents: proximityexit">
        </a-entity>

        <a-entity id="model3D1" gltf-model="#antoine5" position="0.035 0.835 1.428" scale="1 1 1" rotation="0 -171.483 0" proximity-sensor="distance:1" model-opacity="1"
        animation__open="property: model-opacity; to: 0.001; startEvents: proximityenter"
        animation__close="property: model-opacity; to: 1; startEvents: proximityexit">
        </a-entity>

        <a-entity id="model3D3" gltf-model="#loicnrv" position="0.288 0.477 -0.960" scale="0.9 0.9 0.9" rotation="0 -13.192 0" proximity-sensor="distance:1" model-opacity="0.001"
            animation__open="property: model-opacity; to: 1; startEvents: proximityenter"
            animation__close="property: model-opacity; to: 0.01; startEvents: proximityexit">
        </a-entity>

        <a-entity id="model3D4" gltf-model="#loic" position="0.288 0.477 -0.960" scale="0.9 0.9 0.9" rotation="0 -13.192 0" proximity-sensor="distance:1" model-opacity="1"
        animation__open="property: model-opacity; to: 0.001; startEvents: proximityenter"
        animation__close="property: model-opacity; to: 1; startEvents: proximityexit">
        </a-entity>

        <a-entity id="model3D5" gltf-model="#martinnrv" position="-0.781 0.836 2.661" scale="0.9 0.9 0.9" rotation="0 -58.551 0" proximity-sensor="distance:1" model-opacity="0.001"
            animation__open="property: model-opacity; to: 1; startEvents: proximityenter"
            animation__close="property: model-opacity; to: 0.01; startEvents: proximityexit">
        </a-entity>

        <a-entity id="model3D6" gltf-model="#martin" position="-0.781 0.836 2.661" scale="0.9 0.9 0.9" rotation="0 -165.303 0" proximity-sensor="distance:1" model-opacity="1"
        animation__open="property: model-opacity; to: 0.001; startEvents: proximityenter"
        animation__close="property: model-opacity; to: 1; startEvents: proximityexit">
        </a-entity>

        <a-plane color='grey'
                 static-body
                 rotation="-90 0 0" width="10" height="10"
                 position="0 0 0"></a-plane>


                 <a-entity id="rig" movement-controls position="-1 0 1">
                             <a-entity camera position="0 1.5 0" look-controls="pointerLockEnabled: true"></a-entity>
                         </a-entity>

    </a-scene>
</body>

</html>
